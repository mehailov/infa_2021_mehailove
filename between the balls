import random

import pygame
from pygame.draw import *


FPS = 30
pygame.init()
screen = pygame.display.set_mode((400, 400))
Amount_of_balls = 10


def handle_events():
    """
    обрабатывает нажатие на экран или на крестик
    """
    finish_clicked = False
    x = screen.get_width() + 100
    y = screen.get_height() + 100
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            finish_clicked = True
        if event.type == pygame.MOUSEBUTTONDOWN:
            x, y = event.pos
    return(finish_clicked, x, y)


def game_process(xcirc, ycirc, xclick, yclick, rad, score, ball_speed, colour):
    """
    сопоставляет координаты с координатами каждого шара и перемещает их
    xcirc - массив x координат шаров
    ycirc - массив y координат шаров
    xclick - x клика
    yclick - y клика
    rad -  массив радиусов шара
    score - счет игрока
    ball_speed массив скорости шаров по x и y
    colour - массив цветов шаров
    """
    for i in range(len(xcirc)):
        if (xclick - xcirc[i])**2 + (yclick - ycirc[i])**2 < rad[i]**2:
            score += 10
            xcirc[i], ycirc[i], rad[i], ball_speed[i], colour[i] = new_ball(xcirc[i], ycirc[i], rad[i], ball_speed[i])
    for i in range(len(xcirc)):
        xcirc[i], ycirc[i], rad[i], ball_speed[i], colour[i] = move_ball(xcirc[i], ycirc[i], rad[i], ball_speed[i], colour[i])
    return (xcirc, ycirc, rad, score, ball_speed, colour)


def move_ball(xcirc, ycirc, rad, ball_speed, colour):
    """
    перемещает шар по параметрам, связанных со скоростью
    xcirc - координата x перемещенного шара
    ycirc - координата y перемещенного шара
    rad - радиус перемещенного шара
    ball_speed - массив скоростей перемещенного шара
    colour - цвет перемещенного шара
    """
    circle(screen, (0, 0, 0), (xcirc, ycirc), rad)
    if xcirc + ball_speed[0] > 400 and xcirc > 0:
        ball_speed[0] = -ball_speed[0]
    elif xcirc + ball_speed[0] < 0 and xcirc < 0:
        ball_speed[0] = -ball_speed[0]
    if ycirc + ball_speed[1] > 400 and ycirc > 0:
        ball_speed[1] = -ball_speed[1]
    elif ycirc + ball_speed[1] < 0 and ycirc < 0:
        ball_speed[1] = -ball_speed[1]
    ycirc += ball_speed[1]
    xcirc += ball_speed[0]
    circle(screen, colour, (xcirc, ycirc), rad)
    return (xcirc, ycirc, rad, ball_speed, colour)


def new_ball(xcirc, ycirc, rad, ball_speed):
    """
    заменяет нажатый шарик на экране новым со случайными параметрами
    xcirc: координата x замененного шара
    ycirc: координата x замененного шара
    rad - радиус замененного шара
    ball_speed - скорость замененного шара
    """
    circle(screen, (0, 0, 0), (xcirc, ycirc), rad)
    ycirc = random.randint(50, 350)
    xcirc = random.randint(50, 350)
    rad = random.randint(12, 50)
    ball_speed[0] = random.randint(-10, 15)
    ball_speed[1] = random.randint(-10, 10)
    colour = [random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)]
    circle(screen, colour, (xcirc, ycirc), rad)
    return xcirc, ycirc, rad, ball_speed, colour


def score_to_screen(score):
    """
    рисует счет на экране
    score - счет игрока
    """
    myfont = pygame.font.SysFont('Comic Sans MS', 30)
    textsurface = myfont.render(str(score), False, (0, 180, 0))
    rect(screen, (0, 0, 0), (0, 0, 200, 200))
    screen.blit(textsurface, (10, 10))


ycirc = [None] * Amount_of_balls
xcirc = [None] * Amount_of_balls
rad = [None] * Amount_of_balls
ball_speed = []
colour = []
for i in range(Amount_of_balls):
    ycirc[i] = random.randint(20, 380)
    xcirc[i] = random.randint(20, 380)
    rad[i] = random.randint(12, 50)
    ball_speed.append([random.randint(10,50), random.randint(10, 50)])
    colour.append([0, 0, 0])

for i in range(len(xcirc)):
    xcirc[i], ycirc[i], rad[i], ball_speed[i], colour[i] = new_ball(ycirc[i], xcirc[i], rad[i], ball_speed[i])

pygame.display.update()
clock = pygame.time.Clock()
finished = False
pygame.font.init()
xclick = 0
yclick = 0
score = 0
while not finished:
    clock.tick(FPS)
    score_to_screen(score)
    finished, xclick, yclick = handle_events()
    xcirc, ycirc, rad, score, ball_speed, colour = game_process(xcirc, ycirc, xclick, yclick, rad, score, ball_speed, colour)
    xclick = screen.get_width() + 100
    yclick = screen.get_height() + 100
    pygame.display.update()
pygame.quit()
